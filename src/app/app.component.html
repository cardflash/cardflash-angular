<div class="mat-app-background">
<mat-toolbar>
  <mat-toolbar-row>
  <!-- <span>flashcards.siter.eu</span> -->
  <!-- <span class="toolbarSpace"></span> -->
  <div class="headerOptions">
  <mat-button-toggle-group multiple>
    <mat-button-toggle
    title="Allow selection with left-mouse/touch"
    [checked]="this.config.selectionOnTop"
    (change)="selectionOnTopChange($event); this.saveConfig()"
    >
      <mat-icon>layers</mat-icon>
    </mat-button-toggle>

    <mat-button-toggle
    title="Allow selection with left-mouse/touch once"
    [checked]="!this.config.selectionOnTop && zIndex >= 1 && !dragging"
    (change)="zIndex >= 1 ? (zIndex = -1) : (zIndex = 1); this.saveConfig()"
    [disabled]="this.config.selectionOnTop">
      <mat-icon>crop</mat-icon>
    </mat-button-toggle>

    <mat-button-toggle
    title="Draw selection semi-permanently on pdf"
    [checked]="this.config.drawOnPdf"
    (change)="this.config.drawOnPdf = !this.config.drawOnPdf; this.saveConfig()"
    >
      <mat-icon>edit</mat-icon>
    </mat-button-toggle>
  </mat-button-toggle-group>
  <span class="toolbarSpace"></span>
  <input
        class="pdfFileSelector"
        (change)="onFileSelected(); this.saveConfig()"
        type="file"
        accept=".pdf"
        #fileSelector
        label="Select a pdf file"
      />
      
      <span class="toolbarSpace"></span>
      <mat-button-toggle
      title="Single Page Mode (requires page reload)"
      [checked]="this.config.singlePageMode"
      (change)="this.config.singlePageMode = !this.config.singlePageMode; this.saveConfig()"
      >
        <mat-icon>insert_drive_file</mat-icon>
      </mat-button-toggle>

      <span class="toolbarSpace"></span>

      <mat-button-toggle-group multiple>
      <mat-button-toggle
      title="Add selection as image to card"
      [checked]="this.config.addImageOption"
      (change)="this.config.addImageOption = !this.config.addImageOption; this.saveConfig()"
      >
        <mat-icon>image</mat-icon>
      </mat-button-toggle>

      <mat-button-toggle
      title="Add selection as visible text to card"
      [checked]="this.config.addTextOption"
      (change)="this.config.addTextOption = !this.config.addTextOption; this.saveConfig()"
      >
        <mat-icon>format_shapes</mat-icon>
      </mat-button-toggle>

      <mat-button-toggle
      title="Add selection as hidden text to card"
      [disabled]="!this.config.addTextOption"
      [checked]="this.config.addTextAsHidden"
      (change)="this.config.addTextAsHidden = !this.config.addTextAsHidden; this.saveConfig()"
      >
        <mat-icon>visibility_off</mat-icon>
      </mat-button-toggle>

      <mat-button-toggle
      title="Use OCR for text recognition"
      [disabled]="!this.config.addTextOption"
      [checked]="this.config.addOcrTextOption"
      (change)="this.config.addOcrTextOption = !this.config.addOcrTextOption; this.saveConfig()"
      >
      <mat-spinner [diameter]="30" class="ocrSpinner" *ngIf="ocrLoadingNum > 0"></mat-spinner>
      <mat-icon>highlight</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
    <mat-form-field appearance="fill" class="oerLanguageField" style="margin-bottom: -1.5em">
      <mat-label>OCR Language</mat-label>
      <mat-select [disabled]="!this.config.addOcrTextOption" [(value)]="this.config.ocrLanguage">
        <mat-option *ngFor="let lang of OCR_LANGUAGES" [value]="lang.short">
          {{lang.short}} - {{lang.long}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <span class="toolbarSpace"></span>

    <mat-button-toggle class="coloredToggle" 
    title="Automatically add cards to Anki"
    [checked]="this.config.autoAddAnki"
    (change)="this.config.autoAddAnki = !this.config.autoAddAnki; this.saveConfig()"
    >
    <mat-icon>repeat</mat-icon> Anki
  </mat-button-toggle>
</div>
</mat-toolbar-row>
</mat-toolbar>
<div id="pdf-column">
<canvas style="display: none" #previewCanvas></canvas>

<canvas
  #selCanv
  width="816px"
  height="1056px"
  style="position: absolute; display: block; left: 0; right: 0; cursor: crosshair !important;"
  [ngStyle]="{ 'z-index': zIndex }"
  tabindex="0"
  (mousedown)="mouseDown($event)"
  (mouseup)="finishRect()"
  (touchend)="finishRect()"
  (mousemove)="mouseMove($event)"
  (mouseleave)="finishRect()"
  (keydown)="keyDown($event)"
  (contextmenu)="mouseDown($event)"
></canvas>

<div *ngIf="!disablePDFViewer">
<ngx-extended-pdf-viewer 
#ngxPdfViewer
  [listenToURL]="true"
  [src]="pdfSrc"
  [useBrowserLocale]="true"
  [(page)]="this.page"
  [textLayer]="true"
  [zoom]="'page-fit'"
  mobileFriendlyZoom="true"
  [(sidebarVisible)]="sidebarVisible"
  (sidebarVisibleChange)="calcScaling()"
  (pagesLoaded)="loadComplete($event)"
  (pageRendered)="pageRendered($event)"
  [ignoreKeys]="['1', '2', 'w', 's','space']"
  [enablePinchOnMobile]="true"
  [showBorders]="false"
  [pageViewMode]="config.singlePageMode ? 'single' : 'multiple'"
></ngx-extended-pdf-viewer>
</div>
</div>
<div id="cards-column">
  <div class="defaultTitleFieldWrapper">
    <mat-form-field class="defaultTitleField" appearance="outline" style="margin-bottom: -1.25em">
      <mat-label>Default Title</mat-label>
      <input matInput placeholder="Default Document Title"
      [(ngModel)]="this.title" [matAutocomplete]="titleAuto">
      <mat-autocomplete autoActiveFirstOption #titleAuto="matAutocomplete">
        <mat-option *ngFor="let option of this.titleOptions" [value]="option">
          {{option}}
        </mat-option>
      </mat-autocomplete>
      <mat-icon matSuffix>book</mat-icon>
    </mat-form-field>
    <mat-form-field class="defaultTitleField" appearance="outline" style="margin-bottom: -1.25em">
      <mat-label>Anki Deck</mat-label>
      <input matInput placeholder="Deck Name"
      [(ngModel)]="this.config.deckName">
      <mat-icon matSuffix>inbox</mat-icon>
    </mat-form-field>

  <div class="currentCardActions">
  <button class="finishButton" mat-raised-button color="primary" (click)="finishCard()">
    Finish this card
  </button>
    <br>
  <mat-button-toggle-group class="currentCardSideToggle">
    <mat-button-toggle 
    [checked]="this.frontSelected"
    (change)="this.frontSelected = !this.frontSelected; this.saveConfig()"
    >
      Front
    </mat-button-toggle>
    <mat-button-toggle
    [checked]="!this.frontSelected"
    (change)="this.frontSelected = !this.frontSelected; this.saveConfig()">
      Back
    </mat-button-toggle>
  </mat-button-toggle-group>

</div>
</div>
  <div class="cards">
    <app-card
      [(card)]="cards[i]"
      [active]="cards[currIndex].id == card.id"
      [frontActive]="this.frontSelected"
      (delete)="deleteCard($event)"
      [deckName]="config.deckName"
      *ngFor="let card of cards; trackBy: getCardId; let i = index"
    ></app-card>
  </div>
</div>
</div>